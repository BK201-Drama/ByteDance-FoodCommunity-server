{"version":3,"sources":["webpack://@byteinspire/platform/webpack/bootstrap","webpack://@byteinspire/platform/webpack/runtime/define property getters","webpack://@byteinspire/platform/webpack/runtime/hasOwnProperty shorthand","webpack://@byteinspire/platform/webpack/runtime/make namespace object","webpack://@byteinspire/platform/./src/utils/Common.ts","webpack://@byteinspire/platform/./src/constant.ts","webpack://@byteinspire/platform/./src/utils/isContext.ts","webpack://@byteinspire/platform/./src/utils/isUser.ts","webpack://@byteinspire/platform/./src/platforms/common.ts","webpack://@byteinspire/platform/./src/platforms/WeixinMiniProgram.ts","webpack://@byteinspire/platform/./src/platforms/BytedanceMicroapp.ts","webpack://@byteinspire/platform/./src/platforms/Feishu.ts","webpack://@byteinspire/platform/./src/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { AxiosInstance } from 'axios';\nimport { IUser } from 'utils/isUser';\n\nexport abstract class User {\n  abstract current(context: any): Promise<IUser>;\n}\n\nexport interface CommonOptions {\n  user: User;\n}\n\nclass Common {\n  readonly serviceId: string;\n  readonly axios: AxiosInstance;\n  readonly options: CommonOptions;\n  constructor(opts: Common);\n  constructor(\n    serviceId: string,\n    axiosInstance: AxiosInstance,\n    options: CommonOptions\n  );\n  constructor(\n    arg1: Common | string,\n    arg2?: AxiosInstance,\n    arg3?: CommonOptions\n  ) {\n    if (!arg2 && typeof arg1 !== 'string') {\n      this.serviceId = arg1.serviceId;\n      this.axios = arg1.axios;\n      this.options = arg1.options;\n    } else if (arg1 && typeof arg1 === 'string' && arg2 && arg3) {\n      this.serviceId = arg1;\n      this.axios = arg2;\n      this.options = arg3;\n    } else {\n      this.serviceId = '';\n      this.axios = undefined as unknown as AxiosInstance;\n      this.options = undefined as unknown as CommonOptions;\n    }\n\n    if (!this.serviceId || !this.axios || !this.options || !this.options.user) {\n      throw new Error('@byteinspire/platform: Missing arguments.');\n    }\n  }\n}\n\nexport default Common;\n","export enum PlatformEnum {\n  WeixinMiniProgram = 'weixinMiniProgram',\n  BytedanceMicroapp = 'bytedanceMicroapp',\n  Feishu = 'feishu',\n}\n\nexport enum AccessTokenEnum {\n  default = 'default',\n  tenant = 'tenant',\n}\n\nexport enum SessionTypeEnum {\n  default = 'default',\n  feishuUserToken = 'feishuUserToken',\n}\n\nexport enum OriginsEnum {\n  GetAccessToken = '/api/v2/tokens/',\n  GetSessionKey = '/api/v2/sessions/',\n}\n\nexport enum KeyEnum {}\n","export interface IContext {\n  headers: Record<string, string>;\n}\n\nfunction isContext(context: any): context is IContext {\n  return context && context.headers;\n}\n\nexport default isContext;\n","export declare class ObjectId {\n  constructor(id?: string | number | ObjectId);\n  generationTime: number;\n  static cacheHexString?: boolean;\n  static createFromHexString(hexString: string): ObjectId;\n  static createFromTime(time: number): ObjectId;\n  static isValid(id: string | number | ObjectId): boolean;\n  equals(otherID: ObjectId | string): boolean;\n  static generate(time?: number): Buffer;\n  getTimestamp(): Date;\n  toHexString(): string;\n}\n\nexport interface IUser {\n  _id: string | ObjectId;\n}\n\nfunction isUser(user: any): user is IUser {\n  return (\n    user &&\n    user._id &&\n    (typeof user._id === 'string' || typeof user.toHexString === 'function')\n  );\n}\n\nexport default isUser;\n","import {\n  PlatformEnum,\n  AccessTokenEnum,\n  SessionTypeEnum,\n  OriginsEnum,\n} from 'constant';\nimport Common from 'utils/Common';\nimport isContext from 'utils/isContext';\nimport isUser, { ObjectId } from 'utils/isUser';\n\nexport interface IResponse<T = any> {\n  data: T;\n  message: string;\n  code: number;\n}\n\nexport interface IGetAccessTokenOptions {\n  platform: PlatformEnum;\n  type?: AccessTokenEnum;\n}\n\nexport interface IGetAccessToken {\n  accessToken: string;\n  expiresIn: number; // 过期时间\n  expiresAt: number; // 过期时间戳 获取token时间 + expiresIn\n  raw: string;\n  message?: string;\n}\n\nexport async function getAccessToken(\n  instance: Common,\n  options: IGetAccessTokenOptions\n): Promise<IGetAccessToken> {\n  try {\n    const response = await instance.axios.get<IResponse<IGetAccessToken>>(\n      OriginsEnum.GetAccessToken + instance.serviceId,\n      {\n        params: {\n          platform: options.platform,\n          type: options.type,\n        },\n      }\n    );\n    if (response.data.message) {\n      return {\n        accessToken: '',\n        expiresIn: 0,\n        expiresAt: 0,\n        raw: '',\n        message: response.data.message,\n      };\n    }\n    return response.data.data;\n  } catch (err) {\n    return {\n      accessToken: '',\n      expiresIn: 0,\n      expiresAt: 0,\n      raw: '',\n      message: err.response?.data?.message || String(err),\n    };\n  }\n}\n\nexport interface IGetSessionKeyOptions {\n  platform: PlatformEnum;\n  type?: SessionTypeEnum;\n  context: any;\n}\n\nexport interface IGetSessionKey {\n  sessionKey: string;\n  expiresIn: number; // 过期时间\n  expiresAt: number; // 过期时间戳 获取token时间 + expiresIn\n  raw: string;\n  message?: string;\n}\n\nexport async function getSessionKey(\n  instance: Common,\n  options: IGetSessionKeyOptions\n): Promise<IGetSessionKey> {\n  const request = async (id: string | ObjectId) => {\n    if (!id) {\n      return {\n        sessionKey: '',\n        expiresIn: 0,\n        expiresAt: 0,\n        raw: '',\n        message: 'context 缺少必要参数',\n      };\n    }\n    id = String(id);\n    try {\n      const response = await instance.axios.get<IResponse<IGetSessionKey>>(\n        OriginsEnum.GetSessionKey + instance.serviceId,\n        {\n          params: {\n            platform: options.platform,\n            userId: id,\n            type: options.type,\n          },\n        }\n      );\n      if (response.data.message) {\n        return {\n          sessionKey: '',\n          expiresIn: 0,\n          expiresAt: 0,\n          raw: '',\n          message: response.data.message,\n        };\n      }\n      return response.data.data;\n    } catch (err) {\n      return {\n        sessionKey: '',\n        expiresIn: 0,\n        expiresAt: 0,\n        raw: '',\n        message: err.response?.data?.message || String(err),\n      };\n    }\n  };\n\n  if (isUser(options.context)) {\n    return request(options.context._id);\n  }\n  if (isContext(options.context)) {\n    const user = await instance.options.user.current(options.context);\n    return request(user._id);\n  }\n  return {\n    sessionKey: '',\n    expiresIn: 0,\n    expiresAt: 0,\n    raw: '',\n    message: 'context 缺少必要参数',\n  };\n}\n","import Common from 'utils/Common';\nimport { getAccessToken, getSessionKey } from './common';\nimport { PlatformEnum } from 'constant';\n\nclass WeixinMiniProgram extends Common {\n  /**\n   * 获取小程序全局唯一后台接口调用凭据 (access_token)\n   *\n   * https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/access-token/auth.getAccessToken.html\n   */\n  getAccessToken = () => {\n    return getAccessToken(this, { platform: PlatformEnum.WeixinMiniProgram });\n  };\n  /**\n   * 登录凭证校验\n   *\n   * https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/login/auth.code2Session.html\n   */\n  getSessionKey = (context: any) => {\n    return getSessionKey(this, {\n      platform: PlatformEnum.WeixinMiniProgram,\n      context,\n    });\n  };\n}\n\nexport default WeixinMiniProgram;\n","import Common from 'utils/Common';\nimport { getAccessToken, getSessionKey } from './common';\nimport { PlatformEnum } from 'constant';\n\nclass BytedanceMicroapp extends Common {\n  /**\n   * 小程序的全局唯一调用凭据 (access_token)\n   *\n   * https://microapp.bytedance.com/docs/zh-CN/mini-app/develop/server/interface-request-credential/get-access-token\n   */\n  getAccessToken = () => {\n    return getAccessToken(this, { platform: PlatformEnum.BytedanceMicroapp });\n  };\n  /**\n   * 登录凭证校验\n   *\n   * https://microapp.bytedance.com/docs/zh-CN/mini-app/develop/server/log-in/code-2-session\n   */\n  getSessionKey = (context: any) => {\n    return getSessionKey(this, {\n      platform: PlatformEnum.BytedanceMicroapp,\n      context,\n    });\n  };\n}\n\nexport default BytedanceMicroapp;\n","import Common from 'utils/Common';\nimport { getAccessToken, getSessionKey, IGetAccessToken } from './common';\nimport { PlatformEnum, AccessTokenEnum, SessionTypeEnum } from 'constant';\n\nclass Feishu extends Common {\n  /**\n   * 小程序的全局唯一调用凭据 (app_access_token)\n   */\n  getAppAccessToken = () => {\n    return getAccessToken(this, { platform: PlatformEnum.Feishu });\n  };\n  /**\n   * 小程序的全局唯一调用凭据 (tenant_access_token)\n   */\n  getTenantAccessToken = () => {\n    return getAccessToken(this, {\n      platform: PlatformEnum.Feishu,\n      type: AccessTokenEnum.tenant,\n    });\n  };\n  /**\n   * 获取用户凭证\n   * 转换名称 sessionKey -> accessToken\n   */\n  getUserAccessToken = async (context: any): Promise<IGetAccessToken> => {\n    const response = await getSessionKey(this, {\n      platform: PlatformEnum.Feishu,\n      type: SessionTypeEnum.feishuUserToken,\n      context,\n    });\n    const { sessionKey, ...other } = response;\n    return {\n      accessToken: sessionKey,\n      ...other,\n    };\n  };\n  /**\n   * 登录凭证校验\n   */\n  getSessionKey = (context: any) => {\n    return getSessionKey(this, {\n      platform: PlatformEnum.Feishu,\n      context,\n    });\n  };\n}\n\nexport default Feishu;\n","import { AxiosInstance } from 'axios';\nimport Common, { CommonOptions } from 'utils/Common';\nimport WeixinMiniProgram from 'platforms/WeixinMiniProgram';\nimport BytedanceMicroapp from 'platforms/BytedanceMicroapp';\nimport Feishu from 'platforms/Feishu';\n\nclass Platform {\n  private _common: Common;\n\n  public weixinMiniProgram: WeixinMiniProgram;\n  public bytedanceMicroapp: BytedanceMicroapp;\n  public feishu: Feishu;\n\n  constructor(\n    serviceId: string,\n    axiosInstance: AxiosInstance,\n    options: CommonOptions\n  ) {\n    this._common = new Common(serviceId, axiosInstance, options);\n    this.weixinMiniProgram = new WeixinMiniProgram(this._common);\n    this.bytedanceMicroapp = new BytedanceMicroapp(this._common);\n    this.feishu = new Feishu(this._common);\n  }\n}\n\nexport function createPlatformSDK(\n  serviceId: string,\n  axiosInstance: AxiosInstance\n) {\n  return { serviceId, axiosInstance, Platform };\n}\n\nexport default Platform;\n"],"sourceRoot":""}