(()=>{"use strict";var p={};(()=>{p.d=(n,i)=>{for(var e in i)p.o(i,e)&&!p.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:i[e]})}})(),(()=>{p.o=(n,i)=>Object.prototype.hasOwnProperty.call(n,i)})(),(()=>{p.r=n=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}})();var m={};p.r(m),p.d(m,{createPlatformSDK:()=>z,default:()=>J});var L=function(){function n(){}return n}(),k=function(){function n(i,e,r){if(!e&&typeof i!="string"?(this.serviceId=i.serviceId,this.axios=i.axios,this.options=i.options):i&&typeof i=="string"&&e&&r?(this.serviceId=i,this.axios=e,this.options=r):(this.serviceId="",this.axios=void 0,this.options=void 0),!this.serviceId||!this.axios||!this.options||!this.options.user)throw new Error("@byteinspire/platform: Missing arguments.")}return n}();const y=k;var d;(function(n){n.WeixinMiniProgram="weixinMiniProgram",n.BytedanceMicroapp="bytedanceMicroapp",n.Feishu="feishu"})(d||(d={}));var x;(function(n){n.default="default",n.tenant="tenant"})(x||(x={}));var w;(function(n){n.default="default",n.feishuUserToken="feishuUserToken"})(w||(w={}));var h;(function(n){n.GetAccessToken="/api/v2/tokens/",n.GetSessionKey="/api/v2/sessions/"})(h||(h={}));var S;(function(n){})(S||(S={}));function T(n){return n&&n.headers}const M=T;function j(n){return n&&n._id&&(typeof n._id=="string"||typeof n.toHexString=="function")}const A=j;var g=function(n,i,e,r){function s(t){return t instanceof e?t:new e(function(a){a(t)})}return new(e||(e=Promise))(function(t,a){function c(u){try{o(r.next(u))}catch(f){a(f)}}function l(u){try{o(r.throw(u))}catch(f){a(f)}}function o(u){u.done?t(u.value):s(u.value).then(c,l)}o((r=r.apply(n,i||[])).next())})},b=function(n,i){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},r,s,t,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,s&&(t=o[0]&2?s.return:o[0]?s.throw||((t=s.return)&&t.call(s),0):s.next)&&!(t=t.call(s,o[1])).done)return t;switch(s=0,t&&(o=[o[0]&2,t.value]),o[0]){case 0:case 1:t=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!t||o[1]>t[0]&&o[1]<t[3])){e.label=o[1];break}if(o[0]===6&&e.label<t[1]){e.label=t[1],t=o;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(o);break}t[2]&&e.ops.pop(),e.trys.pop();continue}o=i.call(n,e)}catch(u){o=[6,u],s=0}finally{r=t=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}};function _(n,i){var e,r;return g(this,void 0,Promise,function(){var s,t;return b(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,n.axios.get(h.GetAccessToken+n.serviceId,{params:{platform:i.platform,type:i.type}})];case 1:return s=a.sent(),s.data.message?[2,{accessToken:"",expiresIn:0,expiresAt:0,raw:"",message:s.data.message}]:[2,s.data.data];case 2:return t=a.sent(),[2,{accessToken:"",expiresIn:0,expiresAt:0,raw:"",message:((r=(e=t.response)===null||e===void 0?void 0:e.data)===null||r===void 0?void 0:r.message)||String(t)}];case 3:return[2]}})})}function v(n,i){return g(this,void 0,Promise,function(){var e,r,s=this;return b(this,function(t){switch(t.label){case 0:return e=function(a){return g(s,void 0,void 0,function(){var c,l,o,u;return b(this,function(f){switch(f.label){case 0:if(!a)return[2,{sessionKey:"",expiresIn:0,expiresAt:0,raw:"",message:"context \u7F3A\u5C11\u5FC5\u8981\u53C2\u6570"}];a=String(a),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,n.axios.get(h.GetSessionKey+n.serviceId,{params:{platform:i.platform,userId:a,type:i.type}})];case 2:return c=f.sent(),c.data.message?[2,{sessionKey:"",expiresIn:0,expiresAt:0,raw:"",message:c.data.message}]:[2,c.data.data];case 3:return l=f.sent(),[2,{sessionKey:"",expiresIn:0,expiresAt:0,raw:"",message:((u=(o=l.response)===null||o===void 0?void 0:o.data)===null||u===void 0?void 0:u.message)||String(l)}];case 4:return[2]}})})},A(i.context)?[2,e(i.context._id)]:M(i.context)?[4,n.options.user.current(i.context)]:[3,2];case 1:return r=t.sent(),[2,e(r._id)];case 2:return[2,{sessionKey:"",expiresIn:0,expiresAt:0,raw:"",message:"context \u7F3A\u5C11\u5FC5\u8981\u53C2\u6570"}]}})})}var I=function(){var n=function(i,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(r[t]=s[t])},n(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),K=function(n){I(i,n);function i(){var e=n!==null&&n.apply(this,arguments)||this;return e.getAccessToken=function(){return _(e,{platform:d.WeixinMiniProgram})},e.getSessionKey=function(r){return v(e,{platform:d.WeixinMiniProgram,context:r})},e}return i}(y);const F=K;var C=function(){var n=function(i,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(r[t]=s[t])},n(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),E=function(n){C(i,n);function i(){var e=n!==null&&n.apply(this,arguments)||this;return e.getAccessToken=function(){return _(e,{platform:d.BytedanceMicroapp})},e.getSessionKey=function(r){return v(e,{platform:d.BytedanceMicroapp,context:r})},e}return i}(y);const U=E;var B=function(){var n=function(i,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(r[t]=s[t])},n(i,e)};return function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(i,e);function r(){this.constructor=i}i.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),O=function(){return O=Object.assign||function(n){for(var i,e=1,r=arguments.length;e<r;e++){i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n},O.apply(this,arguments)},G=function(n,i,e,r){function s(t){return t instanceof e?t:new e(function(a){a(t)})}return new(e||(e=Promise))(function(t,a){function c(u){try{o(r.next(u))}catch(f){a(f)}}function l(u){try{o(r.throw(u))}catch(f){a(f)}}function o(u){u.done?t(u.value):s(u.value).then(c,l)}o((r=r.apply(n,i||[])).next())})},W=function(n,i){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},r,s,t,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return l([o,u])}}function l(o){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,s&&(t=o[0]&2?s.return:o[0]?s.throw||((t=s.return)&&t.call(s),0):s.next)&&!(t=t.call(s,o[1])).done)return t;switch(s=0,t&&(o=[o[0]&2,t.value]),o[0]){case 0:case 1:t=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!t||o[1]>t[0]&&o[1]<t[3])){e.label=o[1];break}if(o[0]===6&&e.label<t[1]){e.label=t[1],t=o;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(o);break}t[2]&&e.ops.pop(),e.trys.pop();continue}o=i.call(n,e)}catch(u){o=[6,u],s=0}finally{r=t=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},q=function(n,i){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&i.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)i.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(e[r[s]]=n[r[s]]);return e},D=function(n){B(i,n);function i(){var e=n!==null&&n.apply(this,arguments)||this;return e.getAppAccessToken=function(){return _(e,{platform:d.Feishu})},e.getTenantAccessToken=function(){return _(e,{platform:d.Feishu,type:x.tenant})},e.getUserAccessToken=function(r){return G(e,void 0,Promise,function(){var s,t,a;return W(this,function(c){switch(c.label){case 0:return[4,v(this,{platform:d.Feishu,type:w.feishuUserToken,context:r})];case 1:return s=c.sent(),t=s.sessionKey,a=q(s,["sessionKey"]),[2,O({accessToken:t},a)]}})})},e.getSessionKey=function(r){return v(e,{platform:d.Feishu,context:r})},e}return i}(y);const H=D;var P=function(){function n(i,e,r){this._common=new y(i,e,r),this.weixinMiniProgram=new F(this._common),this.bytedanceMicroapp=new U(this._common),this.feishu=new H(this._common)}return n}();function z(n,i){return{serviceId:n,axiosInstance:i,Platform:P}}const J=P;module.exports=m})();

//# sourceMappingURL=index.js.map